#!/bin/bash
#
#   Caress Homebrew and let it know everything is okay.
#
set -euo pipefail
pushd $HOME >/dev/null

# Ensure using system languages.
export PYENV_VERSION=system
export RBENV_VERSION=system

# Get rid of "config" script warnings.
for lang in py rb; do
    if command -v ${lang}env >/dev/null; then
        PATH=${PATH//$(${lang}env root)\/shims:/}
    fi
done

# system Python: pip install --user
PATH=${PATH//$HOME\/Library\/Python\/?.?\/bin:}

# Get rid of .curlrc warning.
restore_curlrc() {
    if [[ -e ~/.curlrc.keep-homebrew-happy ]]; then
        mv ~/.curlrc.keep-homebrew-happy ~/.curlrc
    fi
}
trap restore_curlrc EXIT
if [[ -e ~/.curlrc ]]; then
    mv ~/.curlrc ~/.curlrc.keep-homebrew-happy
fi

/usr/local/bin/brew $*

popd >/dev/null
