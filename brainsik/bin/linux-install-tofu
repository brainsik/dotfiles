#!/usr/bin/env bash
#
# Installs the OpenTofu (tofu) package
#
set -eu -o pipefail
keyrings="/usr/share/keyrings"

echo "ðŸ’¾ Installing OpenTofu (tofu) â€¦"

echo "ðŸ¤– [tofu] Installing required packages"
sudo apt update
sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https curl

echo "ðŸ¤– [tofu] Configuring apt repo"
curl -fsSL https://get.opentofu.org/opentofu.gpg | sudo tee "$keyrings/opentofu.gpg" >/dev/null
curl -fsSL https://packages.opentofu.org/opentofu/tofu/gpgkey | sudo gpg --no-tty --batch --dearmor -o "$keyrings/opentofu-repo.gpg" >/dev/null
echo "deb [signed-by=$keyrings/opentofu.gpg,$keyrings/opentofu-repo.gpg] https://packages.opentofu.org/opentofu/tofu/any/ any main
deb-src [signed-by=$keyrings/opentofu.gpg,$keyrings/opentofu-repo.gpg] https://packages.opentofu.org/opentofu/tofu/any/ any main" \
  | sudo tee /etc/apt/sources.list.d/opentofu.list > /dev/null
sudo chmod a+r /etc/apt/sources.list.d/opentofu.list

echo "ðŸ¤– [tofu] Installing apt packages"
sudo apt update
sudo apt install tofu

echo "âœ… OpenTofu installed."
