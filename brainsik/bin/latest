#!/bin/sh
#
#   Update the local tooling.
#
set -eu

dashes() { python3 -c 'print("=" * 40);'; }

update() { if command -v "$1"; then "$@" && dashes; fi; }

sync() {
    if [ -x "$1/sync" ]; then
        echo "ðŸ¤– Syncing $(basename "$1")"
        "$1/sync"
        dashes
    fi
}


if [ "${1:-}" != "nosync" ]; then
    sync "$HOME/Documents/recovery-codes"
    sync "$HOME/Docs/Mail/mailsik"
fi

# update prezto
if [ -d "$HOME/.zprezto" ]; then
    echo "ðŸ¤– Updating zprezto"
    zsh -i -c 'zprezto-update'

    CWD=$PWD
    cd "$HOME/.zprezto/runcoms"
    for zfile in z*; do
        errno=0
        diff -q "$zfile" "$HOME/.$zfile" >/dev/null || errno=$?
        if [ $errno -eq 1 ]; then
            echo "ðŸ‘€ Files $zfile and $HOME/.$zfile differ"
        elif [ $errno -gt 1 ]; then
            exit $errno
        fi
    done
    cd "$CWD"
fi
dashes

update brewup

update rustup update

update check_nvidia_driver.sh
